<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GALACTIC COMMAND - Star Wars</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Exo 2', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a12 0%, #0d1020 50%, #0a0a12 100%);
            min-height: 100vh;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        /* ÌôÄÎ°úÍ∑∏Îû® Ïä§Ï∫îÎùºÏù∏ */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 255, 0.01) 2px,
                rgba(0, 255, 255, 0.01) 4px
            );
            animation: scanMove 8s linear infinite;
        }

        @keyframes scanMove {
            0% { background-position: 0 0; }
            100% { background-position: 0 100px; }
        }

        /* Ïö∞Ï£º Î∞∞Í≤Ω + Î≥Ñ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(60, 100, 180, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(180, 60, 60, 0.1) 0%, transparent 50%);
        }

        .stars::before,
        .stars::after {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
        }

        .stars::before {
            background-image:
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(3px 3px at 40px 70px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1px 1px at 90px 40px, #4fd1ff, transparent),
                radial-gradient(2px 2px at 130px 80px, rgba(255,232,31,0.8), transparent),
                radial-gradient(1px 1px at 160px 120px, #fff, transparent),
                radial-gradient(3px 3px at 200px 50px, rgba(79,209,255,0.9), transparent),
                radial-gradient(1px 1px at 250px 160px, #ff6b6b, transparent),
                radial-gradient(2px 2px at 300px 100px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 350px 200px, #4fd1ff, transparent),
                radial-gradient(2px 2px at 400px 150px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1px 1px at 450px 80px, #ffe81f, transparent),
                radial-gradient(2px 2px at 500px 220px, rgba(255,255,255,0.6), transparent);
            background-size: 550px 400px;
            animation: starField 60s linear infinite;
        }

        @keyframes starField {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-550px, -400px); }
        }

        /* Ï†úÍµ≠ Î°úÍ≥† ÏõåÌÑ∞ÎßàÌÅ¨ */
        .imperial-logo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            opacity: 0.02;
            pointer-events: none;
            z-index: 0;
            background: radial-gradient(circle, transparent 30%, rgba(255,0,0,0.1) 31%, rgba(255,0,0,0.1) 32%, transparent 33%),
                        radial-gradient(circle, transparent 45%, rgba(255,0,0,0.1) 46%, rgba(255,0,0,0.1) 47%, transparent 48%);
            border-radius: 50%;
            border: 3px solid rgba(255,0,0,0.1);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Ìó§Îçî - Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÉÄÏùº */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px 30px;
            background: rgba(10, 18, 35, 0.9);
            border: 1px solid rgba(255, 232, 31, 0.2);
            border-radius: 16px;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(180deg, #ffe81f 0%, #ffcc00 50%, #ff9500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 4px;
            text-transform: uppercase;
            filter: drop-shadow(0 0 20px rgba(255,232,31,0.5));
            position: relative;
        }

        .header h1::after {
            content: 'GALACTIC COMMAND';
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(180deg, #ffe81f 0%, #ffcc00 50%, #ff9500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: blur(10px);
            opacity: 0.5;
        }

        /* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò - Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÉÄÏùº */
        .tabs {
            display: flex;
            gap: 8px;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(20, 30, 50, 0.8);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 8px;
            color: #8899aa;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .tab:hover {
            background: rgba(30, 50, 80, 0.9);
            color: #4fd1ff;
            border-color: rgba(79, 209, 255, 0.5);
        }

        .tab.active {
            background: linear-gradient(135deg, rgba(79, 209, 255, 0.2) 0%, rgba(79, 209, 255, 0.1) 100%);
            border-color: #4fd1ff;
            color: #4fd1ff;
            box-shadow: 0 0 20px rgba(79, 209, 255, 0.3), inset 0 0 20px rgba(79, 209, 255, 0.1);
        }

        /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ */
        .main {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main {
                grid-template-columns: 1fr;
            }
        }

        /* Ìå®ÎÑê Í≥µÌÜµ Ïä§ÌÉÄÏùº - Î∂ÄÎìúÎü¨Ïö¥ ÎîîÏûêÏù∏ */
        .panel {
            background: rgba(10, 18, 35, 0.95);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5), inset 0 0 30px rgba(79, 209, 255, 0.03);
            backdrop-filter: blur(10px);
        }

        .panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 20px;
            right: 20px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(79, 209, 255, 0.5), transparent);
        }

        /* ÏΩîÎÑà Ïû•Ïãù - Ïà®ÍπÄ */
        .corner-tl, .corner-tr, .corner-bl, .corner-br {
            display: none;
        }

        /* Ìå®ÎÑê Ìó§Îçî */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(79,209,255,0.3);
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: #ffe81f;
            letter-spacing: 3px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title::before {
            content: '‚óÜ';
            color: #4fd1ff;
            font-size: 10px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        /* Îã¨Î†• */
        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav button {
            width: 40px;
            height: 40px;
            background: linear-gradient(180deg, rgba(79,209,255,0.2) 0%, rgba(40,100,140,0.1) 100%);
            border: 2px solid rgba(79, 209, 255, 0.5);
            color: #4fd1ff;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.3s;
            border-radius: 8px;
        }

        .calendar-nav button:hover {
            background: rgba(79, 209, 255, 0.3);
            box-shadow: 0 0 20px rgba(79, 209, 255, 0.5);
            transform: scale(1.05);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .weekday {
            text-align: center;
            font-size: 11px;
            color: #ffe81f;
            padding: 10px 0;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
            background: rgba(255,232,31,0.1);
            border-bottom: 2px solid rgba(255,232,31,0.3);
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            min-height: 52px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 8px;
            background: linear-gradient(180deg, rgba(20,40,60,0.8) 0%, rgba(10,25,40,0.9) 100%);
            border: 1px solid rgba(79, 209, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            font-size: 15px;
            font-weight: 600;
            color: #a8d4e6;
        }

        .calendar-day:hover {
            background: linear-gradient(180deg, rgba(79,209,255,0.2) 0%, rgba(40,100,140,0.3) 100%);
            border-color: #4fd1ff;
            transform: scale(1.08);
            box-shadow: 0 0 15px rgba(79, 209, 255, 0.4);
            z-index: 10;
        }

        .calendar-day.other-month {
            color: #3a5060;
            background: rgba(10, 20, 30, 0.5);
        }

        .calendar-day.today {
            border: 2px solid #ffe81f;
            background: linear-gradient(180deg, rgba(255,232,31,0.15) 0%, rgba(200,160,0,0.1) 100%);
            color: #ffe81f;
            box-shadow: 0 0 20px rgba(255, 232, 31, 0.3);
            font-weight: 800;
        }

        .calendar-day.selected {
            background: linear-gradient(180deg, rgba(79,209,255,0.3) 0%, rgba(40,100,140,0.4) 100%);
            border: 2px solid #4fd1ff;
            color: #ffffff;
            box-shadow: 0 0 25px rgba(79, 209, 255, 0.5), inset 0 0 20px rgba(79, 209, 255, 0.2);
        }

        .calendar-day .dot {
            position: absolute;
            bottom: 6px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow: 0 0 8px #00ff88;
            animation: dotPulse 2s infinite;
        }

        @keyframes dotPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .calendar-day .dot.incomplete {
            background: #ff6b35;
            box-shadow: 0 0 10px #ff6b35;
        }

        .calendar-day.holiday {
            color: #ff6b6b;
        }

        .calendar-day.holiday .holiday-name {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: #ff6b6b;
            white-space: nowrap;
            opacity: 1;
            font-weight: 500;
            letter-spacing: -0.5px;
        }

        .calendar-day.sunday {
            color: #ff6b6b;
        }

        .calendar-day.saturday {
            color: #4fd1ff;
        }

        /* ÎØ∏Îãà ÌÜµÍ≥Ñ */
        .stats-mini {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(79, 209, 255, 0.2);
        }

        .stat-mini {
            text-align: center;
            padding: 15px 10px;
            background: linear-gradient(180deg, rgba(79,209,255,0.1) 0%, rgba(40,80,120,0.05) 100%);
            border: 1px solid rgba(79, 209, 255, 0.3);
            position: relative;
        }

        .stat-mini::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 2px;
            background: #4fd1ff;
        }

        .stat-mini-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 26px;
            font-weight: 800;
            color: #4fd1ff;
            text-shadow: 0 0 15px rgba(79, 209, 255, 0.7);
        }

        .stat-mini-label {
            font-size: 9px;
            color: #8899aa;
            margin-top: 5px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-mini.clickable {
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
        }

        .stat-mini.clickable:hover {
            background: linear-gradient(180deg, rgba(79,209,255,0.2) 0%, rgba(40,80,120,0.15) 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 209, 255, 0.2);
        }

        /* ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Î™®Îã¨ */
        .detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .detail-modal.active {
            display: flex;
        }

        .detail-modal-content {
            background: rgba(10, 18, 35, 0.98);
            border: 2px solid rgba(79, 209, 255, 0.5);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
        }

        .detail-modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            color: #ffe81f;
            margin-bottom: 20px;
            text-align: center;
        }

        .detail-list {
            list-style: none;
        }

        .detail-item {
            padding: 12px 15px;
            background: rgba(20, 35, 55, 0.6);
            border: 1px solid rgba(79, 209, 255, 0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-item.completed {
            opacity: 0.6;
        }

        .detail-item.completed .detail-text {
            text-decoration: line-through;
        }

        .detail-text {
            flex: 1;
            color: #e0f0ff;
        }

        .detail-type {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Orbitron', sans-serif;
        }

        .detail-close {
            margin-top: 20px;
            width: 100%;
            padding: 12px;
            background: rgba(79, 209, 255, 0.2);
            border: 1px solid rgba(79, 209, 255, 0.5);
            border-radius: 8px;
            color: #4fd1ff;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
        }

        .detail-close:hover {
            background: rgba(79, 209, 255, 0.3);
        }

        /* Ìï†Ïùº ÏÑπÏÖò */
        .todo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .todo-date {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }

        .todo-date span {
            color: #ffe81f;
            font-weight: 600;
            font-size: 11px;
            margin-left: 12px;
            background: linear-gradient(90deg, rgba(255,232,31,0.2), rgba(255,200,0,0.1));
            padding: 6px 14px;
            border: 1px solid rgba(255, 232, 31, 0.4);
            letter-spacing: 1px;
        }

        .search-box input {
            background: rgba(20, 35, 55, 0.8);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 8px;
            padding: 8px 15px;
            color: #e0e0e0;
            font-size: 13px;
            width: 180px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #4fd1ff;
            box-shadow: 0 0 15px rgba(79, 209, 255, 0.3);
            width: 220px;
        }

        .search-box input::placeholder {
            color: #6a8a9a;
        }

        /* ÏûÖÎ†• Ìèº - Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÉÄÏùº */
        .input-form {
            background: rgba(15, 25, 45, 0.8);
            border: 1px solid rgba(79, 209, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }

        .input-row:last-child {
            margin-bottom: 0;
        }

        .input-form input[type="text"] {
            flex: 1;
            padding: 14px 18px;
            background: rgba(20, 35, 60, 0.8);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 8px;
            color: #ffffff;
            font-size: 15px;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s;
        }

        .input-form input[type="text"]::placeholder {
            color: rgba(150, 170, 190, 0.6);
        }

        .input-form input[type="text"]:focus {
            outline: none;
            border-color: #4fd1ff;
            box-shadow: 0 0 15px rgba(79, 209, 255, 0.3);
        }

        .input-form input[type="time"] {
            padding: 14px 18px;
            background: rgba(20, 35, 60, 0.8);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 8px;
            color: #4fd1ff;
            font-size: 14px;
            font-family: 'Orbitron', sans-serif;
            color-scheme: dark;
        }

        .input-form select {
            padding: 14px 16px;
            background: rgba(20, 35, 60, 0.9);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 8px;
            color: #ffffff;
            font-size: 13px;
            font-family: 'Exo 2', sans-serif;
            cursor: pointer;
            min-width: 110px;
        }

        .input-form select option {
            background: #0f1932;
            color: #ffffff;
            padding: 10px;
        }

        .input-form select:focus {
            outline: none;
            border-color: #4fd1ff;
            box-shadow: 0 0 15px rgba(79, 209, 255, 0.3);
        }

        .input-form button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-form button:hover {
            transform: scale(1.02);
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.5);
        }

        /* ÌÉÄÏûÖ/Ïö∞ÏÑ†ÎèÑ Î±ÉÏßÄ */
        .type-badge {
            padding: 4px 10px;
            font-size: 9px;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 8px;
        }

        .type-badge.todo {
            background: linear-gradient(90deg, rgba(79,209,255,0.3), rgba(79,209,255,0.1));
            color: #4fd1ff;
            border: 1px solid #4fd1ff;
        }

        .type-badge.schedule {
            background: linear-gradient(90deg, rgba(255,232,31,0.3), rgba(255,232,31,0.1));
            color: #ffe81f;
            border: 1px solid #ffe81f;
        }

        .type-badge.meeting {
            background: linear-gradient(90deg, rgba(255,100,255,0.3), rgba(255,100,255,0.1));
            color: #ff64ff;
            border: 1px solid #ff64ff;
        }

        .priority-indicator {
            width: 4px;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }

        .priority-indicator.urgent { background: linear-gradient(180deg, #ff0000, #ff4444); box-shadow: 0 0 15px #ff0000; animation: urgentPulse 1s infinite; }
        .priority-indicator.high { background: linear-gradient(180deg, #ff6600, #ff9944); box-shadow: 0 0 10px #ff6600; }
        .priority-indicator.normal { background: linear-gradient(180deg, #ffaa00, #ffcc44); box-shadow: 0 0 10px #ffaa00; }
        .priority-indicator.low { background: linear-gradient(180deg, #00cc88, #00ff99); box-shadow: 0 0 10px #00cc88; }

        @keyframes urgentPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .todo-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            color: #4fd1ff;
            margin-right: 12px;
            padding: 3px 8px;
            background: rgba(79,209,255,0.1);
            border: 1px solid rgba(79,209,255,0.3);
        }

        .category-tag {
            padding: 3px 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 9px;
            color: #aabbcc;
            margin-left: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Ìï†Ïùº Î¶¨Ïä§Ìä∏ */
        .todo-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 450px;
            overflow-y: auto;
        }

        .todo-list::-webkit-scrollbar {
            width: 6px;
        }

        .todo-list::-webkit-scrollbar-track {
            background: rgba(79, 209, 255, 0.05);
        }

        .todo-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #4fd1ff, #00a8cc);
            border-radius: 3px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            padding-left: 24px;
            background: linear-gradient(90deg, rgba(20,40,60,0.8) 0%, rgba(15,30,50,0.9) 100%);
            border: 1px solid rgba(79, 209, 255, 0.2);
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s;
            animation: itemSlide 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .todo-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(79,209,255,0.05), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
            pointer-events: none;
        }

        .todo-item:hover::before {
            transform: translateX(100%);
        }

        @keyframes itemSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .todo-item:hover {
            background: linear-gradient(90deg, rgba(30,60,90,0.8) 0%, rgba(25,50,80,0.9) 100%);
            border-color: rgba(79, 209, 255, 0.5);
            box-shadow: 0 0 20px rgba(79, 209, 255, 0.15);
        }

        .todo-item.completed {
            opacity: 0.5;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #5a6a7a;
        }

        .todo-checkbox {
            appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid rgba(79, 209, 255, 0.5);
            margin-right: 14px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            flex-shrink: 0;
            background: rgba(79, 209, 255, 0.05);
        }

        .todo-checkbox:hover {
            border-color: #4fd1ff;
            box-shadow: 0 0 15px rgba(79, 209, 255, 0.4);
        }

        .todo-checkbox:checked {
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
        }

        .todo-checkbox:checked::after {
            content: '';
            position: absolute;
            left: 6px;
            top: 2px;
            width: 6px;
            height: 12px;
            border: solid #000;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        .todo-content {
            flex: 1;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 6px;
        }

        .todo-text {
            flex: 1;
            font-size: 14px;
            color: #e0f0ff;
            font-weight: 500;
            min-width: 150px;
        }

        .todo-actions {
            display: flex;
            gap: 6px;
            opacity: 0.5;
            transition: all 0.3s;
        }

        .todo-item:hover .todo-actions {
            opacity: 1;
        }

        .todo-btn {
            padding: 8px 14px;
            background: rgba(79, 209, 255, 0.1);
            border: 1px solid rgba(79, 209, 255, 0.4);
            border-radius: 6px;
            color: #6a9aaa;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 10;
        }

        .todo-btn.move:hover {
            background: rgba(79, 209, 255, 0.25);
            border-color: #4fd1ff;
            color: #4fd1ff;
        }

        .todo-btn.delete:hover {
            background: rgba(255, 50, 50, 0.25);
            border-color: #ff3232;
            color: #ff3232;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #5a7a8a;
            font-size: 14px;
        }

        .empty-state::before {
            content: '‚ö°';
            display: block;
            font-size: 48px;
            margin-bottom: 16px;
            filter: grayscale(0.5);
        }

        /* Î™®Îã¨ */
        .move-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .move-modal.active {
            display: flex;
        }

        .move-modal-content {
            background: rgba(10, 18, 35, 0.98);
            border: 1px solid rgba(79, 209, 255, 0.5);
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .move-modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: #ffe81f;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .move-modal-todo {
            font-size: 14px;
            color: #a0b0c0;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(79, 209, 255, 0.1);
            border: 1px solid rgba(79, 209, 255, 0.2);
            border-radius: 8px;
        }

        .move-modal-input {
            width: 100%;
            padding: 15px;
            background: rgba(20, 35, 60, 0.8);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            margin-bottom: 20px;
            color: #ffffff;
            color-scheme: dark;
        }

        .move-modal-input:focus {
            outline: none;
            border-color: #4fd1ff;
        }

        .move-modal-buttons {
            display: flex;
            gap: 12px;
        }

        .move-modal-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .move-modal-btn.cancel {
            background: rgba(100, 100, 120, 0.4);
            border: 2px solid rgba(150, 150, 170, 0.4);
            border-radius: 8px;
            color: #8899aa;
        }

        .move-modal-btn.cancel:hover {
            background: rgba(100, 100, 120, 0.6);
        }

        .move-modal-btn.confirm {
            background: linear-gradient(180deg, #4fd1ff 0%, #00a8cc 100%);
            border-radius: 8px;
            color: #000;
            box-shadow: 0 0 20px rgba(79, 209, 255, 0.5);
        }

        .move-modal-btn.confirm:hover {
            box-shadow: 0 0 30px rgba(79, 209, 255, 0.7);
            transform: translateY(-1px);
        }

        /* ÌÜµÍ≥Ñ ÌéòÏù¥ÏßÄ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stats-card {
            background: rgba(10, 18, 35, 0.95);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .stats-card-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 44px;
            font-weight: 800;
            color: #4fd1ff;
            text-shadow: 0 0 30px rgba(79, 209, 255, 0.6);
        }

        .stats-card-label {
            font-size: 11px;
            color: #8899aa;
            margin-top: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .chart-section {
            background: rgba(10, 18, 35, 0.95);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .chart-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #ffe81f;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            height: 180px;
            padding: 0 10px;
        }

        .chart-bar-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .chart-bar {
            width: 100%;
            max-width: 50px;
            background: linear-gradient(180deg, #4fd1ff 0%, #0088cc 100%);
            transition: height 0.5s ease;
            min-height: 4px;
            box-shadow: 0 0 20px rgba(79, 209, 255, 0.5);
            position: relative;
        }

        .chart-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #ffffff;
            opacity: 0.5;
        }

        .chart-bar-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            color: #8899aa;
            font-weight: 600;
        }

        .insights {
            background: rgba(10, 18, 35, 0.95);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(79, 209, 255, 0.15);
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-icon {
            font-size: 28px;
        }

        .insight-text {
            font-size: 14px;
            color: #b0c0d0;
            font-weight: 500;
        }

        /* ÌéòÏù¥ÏßÄ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ÏÑ§Ï†ï ÌéòÏù¥ÏßÄ */
        .settings-section {
            background: rgba(10, 18, 35, 0.95);
            border: 1px solid rgba(79, 209, 255, 0.3);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .settings-section.danger {
            border-color: rgba(255, 50, 50, 0.4);
        }

        .settings-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: #ffe81f;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .settings-desc {
            font-size: 14px;
            color: #8899aa;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .settings-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .settings-btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #4fd1ff 0%, #00a8cc 100%);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .settings-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(79, 209, 255, 0.5);
        }

        .settings-btn.reset {
            background: linear-gradient(135deg, #ff3232 0%, #cc0000 100%);
        }

        .settings-list {
            padding-left: 25px;
            color: #a0b0c0;
            font-size: 14px;
            line-height: 2.2;
        }

        .settings-list strong {
            color: #4fd1ff;
        }

        /* Ïú†Ï†Ä ÏòÅÏó≠ */
        .user-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .login-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4fd1ff;
            box-shadow: 0 0 20px rgba(79, 209, 255, 0.3);
        }

        .login-btn img {
            width: 20px;
            height: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid #4fd1ff;
            box-shadow: 0 0 15px rgba(79, 209, 255, 0.4);
        }

        .user-name {
            font-size: 12px;
            color: #b0c0d0;
            font-family: 'Orbitron', sans-serif;
        }

        .logout-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(255, 50, 50, 0.5);
            color: #ff6666;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 50, 50, 0.2);
            border-color: #ff3232;
        }

        .sync-status {
            font-size: 10px;
            color: #00ff88;
            font-family: 'Orbitron', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(0,255,136,0.1);
            border: 1px solid rgba(0,255,136,0.3);
        }

        .sync-status.offline {
            color: #ff6b35;
            background: rgba(255,107,53,0.1);
            border-color: rgba(255,107,53,0.3);
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
            animation: syncPulse 1.5s infinite;
        }

        @keyframes syncPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        .sync-status.offline .sync-dot {
            background: #ff6b35;
            box-shadow: 0 0 10px #ff6b35;
            animation: none;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        @media (max-width: 900px) {
            .header {
                flex-direction: column;
                gap: 20px;
                padding: 15px 20px;
            }
            .header-left {
                flex-direction: column;
                gap: 15px;
            }
            .tabs {
                flex-wrap: wrap;
                justify-content: center;
            }
            .header-right {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* Î°úÎî© Ïä§ÌîºÎÑà */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(79,209,255,0.2);
            border-top-color: #4fd1ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>
    <div class="stars"></div>
    <div class="imperial-logo"></div>

    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>GALACTIC COMMAND</h1>
                <div class="tabs">
                    <button class="tab active" data-tab="main">MISSIONS</button>
                    <button class="tab" data-tab="stats">ANALYTICS</button>
                    <button class="tab" data-tab="settings">CONTROL</button>
                </div>
            </div>
            <div class="header-right">
                <div id="syncStatus" class="sync-status offline">
                    <span class="sync-dot"></span>
                    <span>LOCAL MODE</span>
                </div>
                <div id="userArea" class="user-area">
                    <button class="login-btn" onclick="googleLogin()">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                        CONNECT
                    </button>
                </div>
            </div>
        </div>

        <!-- Î©îÏù∏ ÌéòÏù¥ÏßÄ -->
        <div class="page active" id="main-page">
            <div class="main">
                <!-- Îã¨Î†• -->
                <div class="panel">
                    <div class="corner-tl"></div>
                    <div class="corner-tr"></div>
                    <div class="corner-bl"></div>
                    <div class="corner-br"></div>
                    <div class="panel-header">
                        <span class="panel-title" id="calendarTitle"></span>
                        <div class="calendar-nav">
                            <button onclick="changeMonth(-1)">‚óÄ</button>
                            <button onclick="changeMonth(1)">‚ñ∂</button>
                        </div>
                    </div>
                    <div class="calendar-weekdays">
                        <div class="weekday">SUN</div>
                        <div class="weekday">MON</div>
                        <div class="weekday">TUE</div>
                        <div class="weekday">WED</div>
                        <div class="weekday">THU</div>
                        <div class="weekday">FRI</div>
                        <div class="weekday">SAT</div>
                    </div>
                    <div class="calendar-days" id="calendarDays"></div>

                    <div class="stats-mini">
                        <div class="stat-mini clickable" onclick="showStatDetail('total')">
                            <div class="stat-mini-value" id="dayTotal">0</div>
                            <div class="stat-mini-label">TODAY</div>
                        </div>
                        <div class="stat-mini clickable" onclick="showStatDetail('completed')">
                            <div class="stat-mini-value" id="dayCompleted">0</div>
                            <div class="stat-mini-label">DONE</div>
                        </div>
                        <div class="stat-mini clickable" onclick="showStatDetail('pending')">
                            <div class="stat-mini-value" id="dayPending">0</div>
                            <div class="stat-mini-label">PENDING</div>
                        </div>
                    </div>
                </div>

                <!-- Ìï†Ïùº -->
                <div class="panel">
                    <div class="corner-tl"></div>
                    <div class="corner-tr"></div>
                    <div class="corner-bl"></div>
                    <div class="corner-br"></div>
                    <div class="todo-header">
                        <div class="todo-date">
                            <span id="selectedDateTitle"></span>
                            <span id="selectedDateSub"></span>
                        </div>
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="üîç Search..." oninput="searchTodos(this.value)">
                        </div>
                    </div>

                    <div class="input-form">
                        <div class="input-row">
                            <input type="text" id="todoInput" placeholder="Enter mission objective..." onkeypress="handleKeyPress(event)">
                        </div>
                        <div class="input-row">
                            <select id="todoType">
                                <option value="todo">üìã TASK</option>
                                <option value="schedule">üìÖ EVENT</option>
                                <option value="meeting">üë• MEETING</option>
                            </select>
                            <input type="time" id="todoTime">
                            <select id="todoPriority">
                                <option value="normal">üü° NORMAL</option>
                                <option value="high">üü† HIGH</option>
                                <option value="urgent">üî¥ URGENT</option>
                                <option value="low">üü¢ LOW</option>
                            </select>
                            <select id="todoCategory">
                                <option value="">CATEGORY</option>
                                <option value="work">WORK</option>
                                <option value="personal">PERSONAL</option>
                                <option value="health">HEALTH</option>
                                <option value="study">STUDY</option>
                            </select>
                            <button onclick="addTodo()">DEPLOY</button>
                        </div>
                    </div>

                    <div class="todo-list" id="todoList"></div>
                </div>
            </div>
        </div>


        <!-- ÌÜµÍ≥Ñ ÌéòÏù¥ÏßÄ -->
        <div class="page" id="stats-page">
            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stats-card-value" id="totalTodos">0</div>
                    <div class="stats-card-label">Total Missions</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-value" id="totalCompleted">0</div>
                    <div class="stats-card-label">Completed</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-value" id="totalRate">0%</div>
                    <div class="stats-card-label">Success Rate</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-value" id="streakDays">0</div>
                    <div class="stats-card-label">Day Streak</div>
                </div>
            </div>

            <div class="chart-section">
                <div class="chart-title">‚óÜ 7-Day Performance</div>
                <div class="chart-bars" id="weeklyChart"></div>
            </div>

            <div class="insights">
                <div class="chart-title">‚óÜ Mission Analysis</div>
                <div id="insightsList"></div>
            </div>
        </div>

        <!-- ÎÇ†Ïßú Ïù¥Îèô Î™®Îã¨ -->
        <div class="move-modal" id="moveModal" onclick="closeMoveModal(event)">
            <div class="move-modal-content" onclick="event.stopPropagation()">
                <div class="move-modal-title">‚óÜ RELOCATE MISSION</div>
                <div class="move-modal-todo" id="moveModalTodo"></div>
                <input type="date" class="move-modal-input" id="moveModalDate">
                <div class="move-modal-buttons">
                    <button class="move-modal-btn cancel" onclick="closeMoveModal()">ABORT</button>
                    <button class="move-modal-btn confirm" onclick="confirmMoveTodo()">CONFIRM</button>
                </div>
            </div>
        </div>

        <!-- ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Î™®Îã¨ -->
        <div class="detail-modal" id="detailModal" onclick="closeDetailModal(event)">
            <div class="detail-modal-content" onclick="event.stopPropagation()">
                <div class="detail-modal-title" id="detailModalTitle">‚óÜ MISSIONS</div>
                <ul class="detail-list" id="detailList"></ul>
                <button class="detail-close" onclick="closeDetailModal()">CLOSE</button>
            </div>
        </div>

        <!-- ÏÑ§Ï†ï ÌéòÏù¥ÏßÄ -->
        <div class="page" id="settings-page">
            <div class="settings-section">
                <h2 class="settings-title">‚óÜ DATA BACKUP</h2>
                <p class="settings-desc">Export or import your mission data as JSON files.</p>
                <div class="settings-buttons">
                    <button class="settings-btn" onclick="exportData()">üì§ EXPORT</button>
                    <button class="settings-btn" onclick="document.getElementById('importFile').click()">üì• IMPORT</button>
                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
                </div>
            </div>

            <div class="settings-section">
                <h2 class="settings-title">‚óÜ SYNC PROTOCOL</h2>
                <p class="settings-desc">Manual cloud synchronization:</p>
                <ol class="settings-list">
                    <li><strong>Export</strong> data from above</li>
                    <li>Save JSON file to cloud folder</li>
                    <li><strong>Import</strong> file on other devices</li>
                </ol>
            </div>

            <div class="settings-section danger">
                <h2 class="settings-title">‚óÜ DANGER ZONE</h2>
                <p class="settings-desc">Permanently delete all mission data.</p>
                <button class="settings-btn reset" onclick="resetData()">üóëÔ∏è PURGE ALL DATA</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ÏÑ§Ï†ï
        // ============================================
        const ALLOWED_EMAIL = "fisherpark@gmail.com";

        const firebaseConfig = {
            apiKey: "AIzaSyBExygT3fT8Ah3ohruhJmORCXwH4h601VM",
            authDomain: "galactic-todo.firebaseapp.com",
            databaseURL: "https://galactic-todo-default-rtdb.firebaseio.com",
            projectId: "galactic-todo",
            storageBucket: "galactic-todo.firebasestorage.app",
            messagingSenderId: "706561556446",
            appId: "1:706561556446:web:811010c40377502a0c674f"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        let db = null;
        let currentUser = null;
        let dbRef = null;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch (e) {
            console.log('Firebase ÏÑ§Ï†ïÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
        }

        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•ÏÜå
        let todos = JSON.parse(localStorage.getItem('todos')) || {};
        let currentDate = new Date();
        let selectedDate = new Date();

        // ÌïúÍµ≠ Í≥µÌú¥Ïùº (Í≥†Ï†ï Í≥µÌú¥Ïùº + 2024-2027 ÏùåÎ†• Í≥µÌú¥Ïùº)
        const koreanHolidays = {
            // Í≥†Ï†ï Í≥µÌú¥Ïùº
            '01-01': 'Ïã†Ï†ï',
            '03-01': 'ÏÇºÏùºÏ†à',
            '05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '06-06': 'ÌòÑÏ∂©Ïùº',
            '08-15': 'Í¥ëÎ≥µÏ†à',
            '10-03': 'Í∞úÏ≤úÏ†à',
            '10-09': 'ÌïúÍ∏ÄÎÇ†',
            '12-25': 'ÌÅ¨Î¶¨Ïä§ÎßàÏä§',
            // 2025ÎÖÑ ÏùåÎ†• Í≥µÌú¥Ïùº
            '2025-01-28': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2025-01-29': 'ÏÑ§ÎÇ†',
            '2025-01-30': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2025-05-05': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†',
            '2025-10-05': 'Ï∂îÏÑùÏó∞Ìú¥',
            '2025-10-06': 'Ï∂îÏÑù',
            '2025-10-07': 'Ï∂îÏÑùÏó∞Ìú¥',
            // 2025ÎÖÑ ÎåÄÏ≤¥Í≥µÌú¥Ïùº
            '2025-03-03': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2025-10-08': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            // 2026ÎÖÑ ÏùåÎ†• Í≥µÌú¥Ïùº
            '2026-02-16': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2026-02-17': 'ÏÑ§ÎÇ†',
            '2026-02-18': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2026-05-24': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†',
            '2026-07-17': 'Ï†úÌóåÏ†à',
            '2026-09-24': 'Ï∂îÏÑùÏó∞Ìú¥',
            '2026-09-25': 'Ï∂îÏÑù',
            '2026-09-26': 'Ï∂îÏÑùÏó∞Ìú¥',
            // 2026ÎÖÑ ÎåÄÏ≤¥Í≥µÌú¥Ïùº
            '2026-03-02': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2026-05-25': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2026-06-03': 'ÏßÄÎ∞©ÏÑ†Í±∞Ïùº',
            '2026-08-17': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2026-10-05': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            // 2027ÎÖÑ ÏùåÎ†• Í≥µÌú¥Ïùº
            '2027-02-06': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2027-02-07': 'ÏÑ§ÎÇ†',
            '2027-02-08': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2027-05-13': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†',
            '2027-07-17': 'Ï†úÌóåÏ†à',
            '2027-10-14': 'Ï∂îÏÑùÏó∞Ìú¥',
            '2027-10-15': 'Ï∂îÏÑù',
            '2027-10-16': 'Ï∂îÏÑùÏó∞Ìú¥',
            // 2027ÎÖÑ ÎåÄÏ≤¥Í≥µÌú¥Ïùº
            '2027-02-09': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-07-19': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-08-16': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-10-04': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-10-11': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-10-18': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-12-27': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº'
        };

        function getHoliday(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const fullDate = `${year}-${month}-${day}`;
            const monthDay = `${month}-${day}`;
            return koreanHolidays[fullDate] || koreanHolidays[monthDay] || null;
        }

        // Google Î°úÍ∑∏Ïù∏
        async function googleLogin() {
            if (!db) {
                alert('Firebase ÏÑ§Ï†ïÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }
            try {
                console.log('Î°úÍ∑∏Ïù∏ ÏãúÎèÑ Ï§ë...');
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.setCustomParameters({ prompt: 'select_account' });
                const result = await firebase.auth().signInWithPopup(provider);
                console.log('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ:', result.user.email);
            } catch (error) {
                console.error('Î°úÍ∑∏Ïù∏ ÏóêÎü¨:', error);
                let errorMsg = 'Î°úÍ∑∏Ïù∏ Ïã§Ìå®\n\n';
                if (error.code === 'auth/popup-blocked') {
                    errorMsg += 'ÌåùÏóÖÏù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§.';
                } else if (error.code === 'auth/popup-closed-by-user') {
                    errorMsg += 'Î°úÍ∑∏Ïù∏ Ï∞ΩÏù¥ Îã´ÌòîÏäµÎãàÎã§.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    errorMsg += 'ÎèÑÎ©îÏù∏ ÎØ∏ÏäπÏù∏: ' + window.location.hostname;
                } else {
                    errorMsg += error.message;
                }
                alert(errorMsg);
            }
        }

        async function logout() {
            try {
                await firebase.auth().signOut();
            } catch (error) {
                console.error('Î°úÍ∑∏ÏïÑÏõÉ ÏóêÎü¨:', error);
            }
        }

        if (db) {
            firebase.auth().onAuthStateChanged(async (user) => {
                console.log('Ïù∏Ï¶ù ÏÉÅÌÉú:', user ? user.email : 'Î°úÍ∑∏ÏïÑÏõÉ');
                if (user && user.email !== ALLOWED_EMAIL) {
                    alert('Ï†ëÍ∑º Í∂åÌïú ÏóÜÏùå\n\nÍ≥ÑÏ†ï: ' + user.email + '\nÌóàÏö©: ' + ALLOWED_EMAIL);
                    await firebase.auth().signOut();
                    return;
                }
                currentUser = user;
                updateUserUI();
                if (user) {
                    dbRef = db.ref('users/' + user.uid + '/todos');
                    startRealtimeSync();
                } else {
                    if (dbRef) { dbRef.off(); dbRef = null; }
                    todos = JSON.parse(localStorage.getItem('todos')) || {};
                    renderCalendar();
                    renderTodos();
                }
            });
        }

        function updateUserUI() {
            const userArea = document.getElementById('userArea');
            const syncStatus = document.getElementById('syncStatus');
            if (currentUser) {
                userArea.innerHTML = `
                    <div class="user-info">
                        <img src="${currentUser.photoURL || ''}" class="user-avatar" alt="User">
                        <span class="user-name">${currentUser.displayName || 'Pilot'}</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">DISCONNECT</button>
                `;
                syncStatus.className = 'sync-status';
                syncStatus.innerHTML = '<span class="sync-dot"></span><span>SYNCED</span>';
            } else {
                userArea.innerHTML = `
                    <button class="login-btn" onclick="googleLogin()">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                        CONNECT
                    </button>
                `;
                syncStatus.className = 'sync-status offline';
                syncStatus.innerHTML = '<span class="sync-dot"></span><span>LOCAL MODE</span>';
            }
        }

        async function saveToCloud() {
            if (!currentUser || !dbRef) return;
            try { await dbRef.set(todos); } catch (e) { console.error('Ï†ÄÏû• ÏóêÎü¨:', e); }
        }

        function startRealtimeSync() {
            if (!currentUser || !dbRef) return;
            dbRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    todos = data;
                } else {
                    saveToCloud();
                }
                localStorage.setItem('todos', JSON.stringify(todos));
                renderCalendar();
                renderTodos();
            });
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateKR(date) {
            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')} ${days[date.getDay()]}`;
        }

        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
            if (currentUser && db) saveToCloud();
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            document.getElementById('calendarTitle').textContent = `${year}.${String(month + 1).padStart(2, '0')}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                const div = document.createElement('div');
                div.className = 'calendar-day other-month';
                div.textContent = day;
                calendarDays.appendChild(div);
            }

            const today = new Date();
            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDate(date);
                const dayOfWeek = date.getDay();
                const div = document.createElement('div');
                div.className = 'calendar-day';

                // ÎÇ†Ïßú Ïà´Ïûê
                const dayNum = document.createElement('span');
                dayNum.textContent = day;
                div.appendChild(dayNum);

                // Ï£ºÎßê ÏÉâÏÉÅ
                if (dayOfWeek === 0) div.classList.add('sunday');
                if (dayOfWeek === 6) div.classList.add('saturday');

                // Í≥µÌú¥Ïùº Ï≤¥ÌÅ¨
                const holiday = getHoliday(date);
                if (holiday) {
                    div.classList.add('holiday');
                    const holidayLabel = document.createElement('div');
                    holidayLabel.className = 'holiday-name';
                    holidayLabel.textContent = holiday;
                    div.appendChild(holidayLabel);
                }

                if (date.toDateString() === today.toDateString()) div.classList.add('today');
                if (date.toDateString() === selectedDate.toDateString()) div.classList.add('selected');

                const dayTodos = todos[dateStr] || [];
                if (dayTodos.length > 0) {
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    // Ìï†Ïùº(todo)Îßå ÏôÑÎ£å Ï≤¥ÌÅ¨Ïóê Ìè¨Ìï®
                    const dayTasks = dayTodos.filter(t => t.type === 'todo');
                    if (dayTasks.length > 0 && !dayTasks.every(t => t.completed)) {
                        dot.classList.add('incomplete');
                    }
                    div.appendChild(dot);
                }

                div.onclick = () => selectDate(date);
                calendarDays.appendChild(div);
            }

            const remainingDays = 42 - (startDay + totalDays);
            for (let day = 1; day <= remainingDays; day++) {
                const div = document.createElement('div');
                div.className = 'calendar-day other-month';
                div.textContent = day;
                calendarDays.appendChild(div);
            }

            updateDayStats();
        }

        function selectDate(date) {
            selectedDate = date;
            renderCalendar();
            renderTodos();
            updateDayStats();
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        function renderTodos() {
            const dateStr = formatDate(selectedDate);
            const dayTodos = todos[dateStr] || [];

            document.getElementById('selectedDateTitle').textContent = formatDateKR(selectedDate);

            const today = new Date();
            if (selectedDate.toDateString() === today.toDateString()) {
                document.getElementById('selectedDateSub').textContent = 'TODAY';
            } else {
                const diff = Math.ceil((selectedDate - today) / (1000 * 60 * 60 * 24));
                document.getElementById('selectedDateSub').textContent = diff > 0 ? `D-${diff}` : diff < 0 ? `D+${Math.abs(diff)}` : '';
            }

            const todoList = document.getElementById('todoList');
            if (dayTodos.length === 0) {
                todoList.innerHTML = '<div class="empty-state">No missions assigned<br><small>Deploy new objectives above</small></div>';
                return;
            }

            const typeLabels = { todo: 'TASK', schedule: 'EVENT', meeting: 'MEETING' };
            const categoryLabels = { work: 'WORK', personal: 'PERSONAL', health: 'HEALTH', study: 'STUDY' };

            todoList.innerHTML = dayTodos.map((todo, index) => `
                <div class="todo-item ${todo.completed ? 'completed' : ''}">
                    <div class="priority-indicator ${todo.priority || 'normal'}"></div>
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${index})">
                    <div class="todo-content">
                        ${todo.time ? `<span class="todo-time">${todo.time}</span>` : ''}
                        <span class="type-badge ${todo.type || 'todo'}">${typeLabels[todo.type] || 'TASK'}</span>
                        <span class="todo-text">${escapeHtml(todo.text)}</span>
                        ${todo.category ? `<span class="category-tag">${categoryLabels[todo.category] || todo.category}</span>` : ''}
                    </div>
                    <div class="todo-actions">
                        <button class="todo-btn move" onclick="openMoveModal(${index})">MOVE</button>
                        <button class="todo-btn delete" onclick="deleteTodo(${index})">DELETE</button>
                    </div>
                </div>
            `).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            if (!text) return;

            const type = document.getElementById('todoType').value;
            const time = document.getElementById('todoTime').value;
            const priority = document.getElementById('todoPriority').value;
            const category = document.getElementById('todoCategory').value;

            const dateStr = formatDate(selectedDate);
            if (!todos[dateStr]) todos[dateStr] = [];

            todos[dateStr].push({
                text, type, time, priority, category,
                completed: false,
                createdAt: new Date().toISOString()
            });

            todos[dateStr].sort((a, b) => {
                // Ïö∞ÏÑ†ÏàúÏúÑ Î®ºÏ†Ä: urgent > high > normal > low
                const priorityOrder = { urgent: 0, high: 1, normal: 2, low: 3 };
                const prioA = priorityOrder[a.priority] ?? 2;
                const prioB = priorityOrder[b.priority] ?? 2;
                if (prioA !== prioB) return prioA - prioB;
                // Í∞ôÏùÄ Ïö∞ÏÑ†ÏàúÏúÑÎ©¥ ÏãúÍ∞ÑÏàú
                if (a.time && !b.time) return -1;
                if (!a.time && b.time) return 1;
                if (a.time && b.time) return a.time.localeCompare(b.time);
                return 0;
            });

            saveTodos();
            renderTodos();
            renderCalendar();
            input.value = '';
            document.getElementById('todoTime').value = '';
            input.focus();
        }

        function handleKeyPress(e) { if (e.key === 'Enter') addTodo(); }

        function toggleTodo(index) {
            const dateStr = formatDate(selectedDate);
            todos[dateStr][index].completed = !todos[dateStr][index].completed;
            if (todos[dateStr][index].completed) {
                todos[dateStr][index].completedAt = new Date().toISOString();
            }
            saveTodos();
            renderTodos();
            renderCalendar();
        }

        function deleteTodo(index) {
            const dateStr = formatDate(selectedDate);
            todos[dateStr].splice(index, 1);
            if (todos[dateStr].length === 0) delete todos[dateStr];
            saveTodos();
            renderTodos();
            renderCalendar();
        }

        function updateDayStats() {
            const dateStr = formatDate(selectedDate);
            const dayTodos = todos[dateStr] || [];
            // Ìï†Ïùº(todo)Îßå ÌÜµÍ≥ÑÏóê Ìè¨Ìï®
            const tasks = dayTodos.filter(t => t.type === 'todo');
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;

            document.getElementById('dayTotal').textContent = total;
            document.getElementById('dayCompleted').textContent = completed;
            document.getElementById('dayPending').textContent = pending;
        }

        function showStatDetail(type) {
            const dateStr = formatDate(selectedDate);
            const dayTodos = todos[dateStr] || [];
            const tasks = dayTodos.filter(t => t.type === 'todo');

            let filtered = [];
            let title = '';

            if (type === 'total') {
                filtered = tasks;
                title = '‚óÜ ALL TASKS';
            } else if (type === 'completed') {
                filtered = tasks.filter(t => t.completed);
                title = '‚óÜ COMPLETED';
            } else if (type === 'pending') {
                filtered = tasks.filter(t => !t.completed);
                title = '‚óÜ PENDING';
            }

            document.getElementById('detailModalTitle').textContent = title + ` (${formatDateKR(selectedDate)})`;

            const list = document.getElementById('detailList');
            if (filtered.length === 0) {
                list.innerHTML = '<li class="detail-item"><span class="detail-text" style="color:#6a8a9a;">No items</span></li>';
            } else {
                list.innerHTML = filtered.map(todo => `
                    <li class="detail-item ${todo.completed ? 'completed' : ''}">
                        <span class="detail-text">${escapeHtml(todo.text)}</span>
                        ${todo.priority === 'urgent' ? '<span style="color:#ff6b6b;">üî¥</span>' : ''}
                        ${todo.priority === 'high' ? '<span style="color:#ffa500;">üü†</span>' : ''}
                    </li>
                `).join('');
            }

            document.getElementById('detailModal').classList.add('active');
        }

        function closeDetailModal(event) {
            if (event && event.target !== document.getElementById('detailModal')) return;
            document.getElementById('detailModal').classList.remove('active');
        }

        function renderStats() {
            let total = 0, completed = 0;
            Object.values(todos).forEach(dayTodos => {
                dayTodos.forEach(todo => {
                    // ÏùºÏ†ï(schedule)ÏùÄ ÌÜµÍ≥ÑÏóêÏÑú Ï†úÏô∏
                    if (todo.type !== 'todo') return;
                    total++;
                    if (todo.completed) completed++;
                });
            });

            document.getElementById('totalTodos').textContent = total;
            document.getElementById('totalCompleted').textContent = completed;
            document.getElementById('totalRate').textContent = total > 0 ? Math.round(completed / total * 100) + '%' : '0%';

            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                const dayTodos = (todos[dateStr] || []).filter(t => t.type === 'todo');
                if (dayTodos.length === 0) { if (i === 0) continue; break; }
                if (dayTodos.every(t => t.completed)) streak++;
                else break;
            }
            document.getElementById('streakDays').textContent = streak;

            renderWeeklyChart();
            renderInsights();
        }

        function renderWeeklyChart() {
            const chart = document.getElementById('weeklyChart');
            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            const today = new Date();
            let html = '';

            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                // ÏùºÏ†ï(schedule)ÏùÄ ÌÜµÍ≥ÑÏóêÏÑú Ï†úÏô∏
                const dayTodos = (todos[dateStr] || []).filter(t => t.type === 'todo');
                let rate = 0;
                if (dayTodos.length > 0) {
                    rate = Math.round(dayTodos.filter(t => t.completed).length / dayTodos.length * 100);
                }
                html += `<div class="chart-bar-wrapper"><div class="chart-bar" style="height: ${Math.max(rate, 4)}%"></div><div class="chart-bar-label">${days[date.getDay()]}</div></div>`;
            }
            chart.innerHTML = html;
        }

        function renderInsights() {
            const insights = [];
            const days = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            const dayStats = Array(7).fill(null).map(() => ({ total: 0, completed: 0 }));

            Object.keys(todos).forEach(dateStr => {
                const day = new Date(dateStr).getDay();
                todos[dateStr].forEach(todo => {
                    // ÏùºÏ†ï(schedule)ÏùÄ ÌÜµÍ≥ÑÏóêÏÑú Ï†úÏô∏
                    if (todo.type !== 'todo') return;
                    dayStats[day].total++;
                    if (todo.completed) dayStats[day].completed++;
                });
            });

            let worstDay = -1, worstRate = 101, bestDay = -1, bestRate = -1;
            dayStats.forEach((stat, day) => {
                if (stat.total >= 3) {
                    const rate = stat.completed / stat.total * 100;
                    if (rate < worstRate) { worstRate = rate; worstDay = day; }
                    if (rate > bestRate) { bestRate = rate; bestDay = day; }
                }
            });

            if (bestDay >= 0) insights.push({ icon: 'üèÜ', text: `Best performance on ${days[bestDay]} (${Math.round(bestRate)}%)` });
            if (worstDay >= 0 && worstRate < 70) insights.push({ icon: 'üí™', text: `Improve ${days[worstDay]} performance (${Math.round(worstRate)}%)` });

            let total = 0, completed = 0;
            Object.values(todos).forEach(dayTodos => {
                dayTodos.forEach(todo => {
                    // ÏùºÏ†ï(schedule)ÏùÄ ÌÜµÍ≥ÑÏóêÏÑú Ï†úÏô∏
                    if (todo.type !== 'todo') return;
                    total++;
                    if (todo.completed) completed++;
                });
            });

            if (total > 0) {
                const rate = completed / total * 100;
                if (rate >= 80) insights.push({ icon: 'üéâ', text: 'Outstanding! Success rate over 80%' });
                else if (rate >= 50) insights.push({ icon: 'üëç', text: 'Good progress! Keep pushing forward' });
                else insights.push({ icon: 'üî•', text: 'Break down missions into smaller tasks' });
            }

            if (insights.length === 0) insights.push({ icon: 'üìä', text: 'Complete more missions for detailed analysis' });

            document.getElementById('insightsList').innerHTML = insights.map(i => `
                <div class="insight-item"><span class="insight-icon">${i.icon}</span><span class="insight-text">${i.text}</span></div>
            `).join('');
        }

        // ÌÉ≠ Ï†ÑÌôò
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + '-page').classList.add('active');

                if (tab.dataset.tab === 'stats') renderStats();
            });
        });

        // Î™®Îã¨
        let movingTodoIndex = null;

        function openMoveModal(index) {
            const dateStr = formatDate(selectedDate);
            const todo = todos[dateStr][index];
            movingTodoIndex = index;
            document.getElementById('moveModalTodo').textContent = todo.text;
            document.getElementById('moveModalDate').value = dateStr;
            document.getElementById('moveModal').classList.add('active');
        }

        function closeMoveModal(event) {
            if (event && event.target !== document.getElementById('moveModal')) return;
            document.getElementById('moveModal').classList.remove('active');
            movingTodoIndex = null;
        }

        function confirmMoveTodo() {
            const newDateStr = document.getElementById('moveModalDate').value;
            const oldDateStr = formatDate(selectedDate);
            if (!newDateStr) { alert('Select a date'); return; }
            if (newDateStr === oldDateStr) { alert('Same date selected'); return; }

            const todo = todos[oldDateStr][movingTodoIndex];
            todos[oldDateStr].splice(movingTodoIndex, 1);
            if (todos[oldDateStr].length === 0) delete todos[oldDateStr];
            if (!todos[newDateStr]) todos[newDateStr] = [];
            todos[newDateStr].unshift(todo);

            saveTodos();
            closeMoveModal();
            renderCalendar();
            renderTodos();
        }

        function exportData() {
            const data = { todos, exportedAt: new Date().toISOString(), version: '2.0' };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `galactic-backup-${formatDate(new Date())}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.todos && confirm('Replace current data?')) {
                        todos = data.todos;
                        saveTodos();
                        renderCalendar();
                        renderTodos();
                        alert('Data imported successfully!');
                    }
                } catch (err) { alert('Invalid file format'); }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetData() {
            if (confirm('DELETE ALL DATA?\nThis cannot be undone.')) {
                if (confirm('Final confirmation - DELETE EVERYTHING?')) {
                    todos = {};
                    saveTodos();
                    renderCalendar();
                    renderTodos();
                }
            }
        }

        // ÏïåÎ¶º Í∏∞Îä•
        let notificationPermission = Notification.permission;

        async function requestNotificationPermission() {
            if ('Notification' in window) {
                notificationPermission = await Notification.requestPermission();
                if (notificationPermission === 'granted') {
                    alert('ÏïåÎ¶ºÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§!');
                }
            }
        }

        function checkNotifications() {
            if (notificationPermission !== 'granted') return;

            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            const dateStr = formatDate(now);
            const dayTodos = todos[dateStr] || [];

            dayTodos.forEach(todo => {
                if (todo.time === currentTime && !todo.completed && !todo.notified) {
                    new Notification('GALACTIC COMMAND', {
                        body: `üöÄ ${todo.text}`,
                        icon: 'https://cdn-icons-png.flaticon.com/512/616/616408.png'
                    });
                    todo.notified = true;
                    saveTodos();
                }
            });
        }

        // 1Î∂ÑÎßàÎã§ ÏïåÎ¶º Ï≤¥ÌÅ¨
        setInterval(checkNotifications, 60000);

        // Í≤ÄÏÉâ Í∏∞Îä•
        function searchTodos(query) {
            if (!query.trim()) {
                renderTodos();
                return;
            }

            const results = [];
            Object.keys(todos).forEach(dateStr => {
                todos[dateStr].forEach((todo, index) => {
                    if (todo.text.toLowerCase().includes(query.toLowerCase())) {
                        results.push({ ...todo, date: dateStr, index });
                    }
                });
            });

            const todoList = document.getElementById('todoList');
            if (results.length === 0) {
                todoList.innerHTML = '<div class="empty-state">No results found</div>';
            } else {
                todoList.innerHTML = results.map(todo => `
                    <div class="todo-item ${todo.completed ? 'completed' : ''}" onclick="goToDate('${todo.date}')">
                        <div class="priority-indicator ${todo.priority || 'normal'}"></div>
                        <div class="todo-content">
                            <span class="todo-text">${escapeHtml(todo.text)}</span>
                            <span style="color:#6a8a9a;font-size:11px;margin-left:10px;">${todo.date}</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        function goToDate(dateStr) {
            selectedDate = new Date(dateStr);
            document.getElementById('searchInput').value = '';
            renderCalendar();
            renderTodos();
            updateDayStats();
        }

        // Ï¥àÍ∏∞Ìôî
        renderCalendar();
        renderTodos();
        updateDayStats();

        // ÏïåÎ¶º Í∂åÌïú Ï≤¥ÌÅ¨
        if ('Notification' in window && Notification.permission === 'default') {
            setTimeout(() => {
                if (confirm('Ìï†Ïùº ÏïåÎ¶ºÏùÑ Î∞õÏúºÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    requestNotificationPermission();
                }
            }, 3000);
        }
    </script>
</body>
</html>
